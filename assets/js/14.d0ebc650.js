(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{286:function(e,t,a){"use strict";a.r(t);var s=a(1),l=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"总结思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结思考"}},[e._v("#")]),e._v(" 总结思考")]),e._v(" "),a("h2",{attrs:{id:"为什么要写这个组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要写这个组件"}},[e._v("#")]),e._v(" 为什么要写这个组件?")]),e._v(" "),a("p",[e._v("自己在后台管理项目中, 经常性的使用 table 组件并进行二次封装, 但封装层度比较浅显太有针对性, 移植组件到新项目不好维护, 于是干脆自己写一个发布到 npm 上吧, 基本要求就是两点:")]),e._v(" "),a("ul",[a("li",[e._v("支持 element-ui table 的所有 api")]),e._v(" "),a("li",[e._v("额外添加扩展功能")])]),e._v(" "),a("h2",{attrs:{id:"为什么这么设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么这么设计"}},[e._v("#")]),e._v(" 为什么这么设计?")]),e._v(" "),a("p",[e._v("在常见的组件 api 设计中，都是把参数分散定义在 "),a("code",[e._v("props")]),e._v("中，如")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'page'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'columns'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),a("p",[e._v("但这样会导致一个问题，父组件参数过于分散，参考如下场景：")]),e._v(" "),a("blockquote",[a("p",[e._v("在使用一个 table 组件时，通常会在 data 函数中定义 table 状态的变量 data，loading，order，orderColumn，currentPage，pageSize，pageSizes，pagetotal，同时还需要在 mehotd 中定义一个 getData 的函数，里面的过程也是重复的，加载 loading->获取分页排序参数->获取数据->回填数据分页->关闭 loading，变量定义过多会显得杂乱不好维护，如果页面上有一个 table 尚且如此，如果有三四个 table，那岂不是 data1，data2，data3...")])]),e._v(" "),a("p",[e._v("所以选择了只定义一个对象参数 table，由"),a("code",[e._v("v-model")]),e._v(" 传递，用户只需要传递自己要覆盖的的配置，其他额外参数由组件内部初始化之后自动添加在 table 中。")]),e._v(" "),a("p",[e._v("用户不需要手动定义通用分页排序加载等参数，也可直接通过 "),a("code",[e._v("this.table.xxxx")]),e._v(" 来进行使用。")]),e._v(" "),a("h2",{attrs:{id:"遇到哪些比较难的问题？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到哪些比较难的问题？"}},[e._v("#")]),e._v(" 遇到哪些比较难的问题？")]),e._v(" "),a("h3",{attrs:{id:"参数无法定义在计算属性上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数无法定义在计算属性上"}},[e._v("#")]),e._v(" 参数无法定义在计算属性上")]),e._v(" "),a("p",[e._v("由于在 api 的设计上，table 参数是由 v-model 传递，再由组件内部向上传递其他内置参数，就导致了 table 参数无法设置为计算属性。如何解决 table 属性是动态变化的场景呢？解决办法有两个:")]),e._v(" "),a("ol",[a("li",[e._v("在发生变化时手动赋值覆盖")]),e._v(" "),a("li",[e._v("添加了 "),a("code",[e._v("attach")]),e._v(" 参数,可以为计算属性，attach 发生变化，会同步合并到 table 对象里")])]),e._v(" "),a("h3",{attrs:{id:"多级表头-slot-无法穿透-多级表头显隐列展示异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多级表头-slot-无法穿透-多级表头显隐列展示异常"}},[e._v("#")]),e._v(" 多级表头 slot 无法穿透 , 多级表头显隐列展示异常")]),e._v(" "),a("p",[e._v("这是漫长的踩坑之路，有以下几个阶段。")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("因为 el-table 的多级表头，是在 column 中嵌套 column，这里就只有写个递归组件，但是 slot 就卡在这里，无法在进行向下传递。slot 穿透流程变成：自定义 slot -> agel-table slot -> agel-column slot -> 递归循环自身（x）。")])]),e._v(" "),a("li",[a("p",[e._v("探索 N 久之后，利用"),a("code",[e._v("provide,inject")]),e._v("直接向下传递 table "),a("code",[e._v("$scopedSlots")]),e._v(",不用层层传递，使用 "),a("code",[e._v("$slots,$scopedSlots")]),e._v("生成 vnode，直接渲染在模板上, 解决了这个问题，算是很冷门的解决方案。slot 穿透流程变成：自定义 slot -> agel-column slot -> 递归循环自身（√）。")])]),e._v(" "),a("li",[a("p",[e._v("此时组件结构：el-table -> agel-column(v-for)-> el-table-column，在做动态显隐列功能时，修改多级表头列的 display 属性，页面列的渲染会出现递减，递减数量为多级表头的 children 的长度，把结构改成 el-table -> el-table-column(v-for)，则不会出现这个问题，可是这样写又无法递归循环 el-table-column，成了死循环。")])]),e._v(" "),a("li",[a("p",[e._v("再次尝试修改组件嵌套结构：el-table-> agel-columns -> el-table-column(v-for)，使用 vue-Fragment 组件解决组件无法返回多个元素的问题，但仍然没有解决问题，反而列的顺序会发生异常，第一列会变成最后一列。")])]),e._v(" "),a("li",[a("p",[e._v("无奈只有判断当前列中是否存在多级表头，如果存在，当列属性发生变化，更新列 key，重新渲染所有的列，这倒是可以解决问题，只不过性能上不太合理，而且重新渲染会出现列表闪烁的情况。")])]),e._v(" "),a("li",[a("p",[e._v("把 agel-column 用 jsx 改写成函数，直接递归生成 el-table-column vnode，直接渲染在 el-table 下，就不存在嵌套，解决问题。")])]),e._v(" "),a("li",[a("p",[e._v("又发现多级表头在显示隐藏子列时，当 children 为空时候，显示列异常, 重新为父级设置新的 key 值, 强制使其重新渲染, 解决。")])])]),e._v(" "),a("h3",{attrs:{id:"element-ui-table-一些潜在问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#element-ui-table-一些潜在问题"}},[e._v("#")]),e._v(" element-ui table 一些潜在问题")]),e._v(" "),a("p",[e._v("自己在封装的过程中，发现了不少 element table 自身存在的 bug")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://codepen.io/agrass-github/pen/ExxjXVO",target:"_blank",rel:"noopener noreferrer"}},[e._v("v.2.12 显示合计异常 bug 重现"),a("OutboundLink")],1),e._v(", 调用 doLayot 可解决")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://codepen.io/agrass-github/pen/BaaNRae",target:"_blank",rel:"noopener noreferrer"}},[e._v("v.2.12 列无法对齐 bug 重现"),a("OutboundLink")],1),e._v(", 调用 doLayot 可解决")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://codepen.io/agrass-github/pen/eYYBBPX",target:"_blank",rel:"noopener noreferrer"}},[e._v("v.2.12 多级表头显隐列 bug 重现"),a("OutboundLink")],1),e._v(", 强制重新渲染当前列可解决")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://codepen.io/agrass-github/pen/zYYowvm",target:"_blank",rel:"noopener noreferrer"}},[e._v("v.2.12 隐藏表头控制台报错 bug 重现"),a("OutboundLink")],1),e._v(",暂无解决")])]),e._v(" "),a("h3",{attrs:{id:"vuepress-相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vuepress-相关问题"}},[e._v("#")]),e._v(" vuepress 相关问题")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("官网对特定页面的自定义布局给出的说明是"),a("code",[e._v("如果你希望使用完全自定义的组件代替页面（同时只保留导航栏）")]),e._v(", 可实际上并不会保留导航栏, 参考 "),a("a",{attrs:{href:"https://github.com/vuejs/vuepress/issues/1469",target:"_blank",rel:"noopener noreferrer"}},[e._v("issus:NavBar missing with Custom Layout"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("在 md 文件中使用 vue 组件刷新后报错卡死, 开发环境正常, 生成环境报错, 参考 "),a("a",{attrs:{href:"https://github.com/vuejs/vuepress/issues/1692",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue: Failed to execute 'appendChild' on 'Node'"),a("OutboundLink")],1),e._v(", 使用 ClientOnly 组件包裹可解决")])])])])}),[],!1,null,null,null);t.default=l.exports}}]);